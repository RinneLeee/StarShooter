<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Expense Splitter</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/lz-string@1.5.0/libs/lz-string.min.js"></script>
    
    <style>
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #fafafa;
            color: #171717;
            -webkit-font-smoothing: antialiased;
        }

        /* Mobile Scaling: Reduce base size by ~10% on small screens for better density */
        @media (max-width: 640px) {
            html { font-size: 14px; }
        }

        /* Minimalist Scrollbar Styling */
        ::-webkit-scrollbar { height: 6px; width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #e5e5e5; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #d4d4d4; }

        /* Animation Utilities */
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        .animate-slide-up { animation: slideUp 0.3s ease-out; }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Marquee Animation for long names */
        .marquee-container { overflow: hidden; white-space: nowrap; position: relative; }
        .marquee-content { display: inline-block; animation: marquee 10s linear infinite; padding-right: 2rem; }
        @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
        .marquee-container:hover .marquee-content { animation-play-state: paused; }
    </style>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        /* =========================================
           CONSTANTS & CONFIG
           ========================================= */
        const CURRENCIES = {
            'USD': { symbol: '$', label: 'USD ($)' },
            'RM': { symbol: 'RM', label: 'RM (MYR)' },
            'YEN': { symbol: '¥', label: 'YEN (JPY)' },
            'TWD': { symbol: 'NT$', label: 'TWD (NT$)' },
            'HKD': { symbol: 'HK$', label: 'HKD ($)' },
            'SGD': { symbol: 'S$', label: 'SGD ($)' },
            'IDR': { symbol: 'Rp', label: 'IDR (Rp)' },
            'THB': { symbol: '฿', label: 'THB (฿)' },
            'AUD': { symbol: 'A$', label: 'AUD ($)' }
        };

        /* =========================================
           ICON COMPONENTS (SVG)
           ========================================= */
        const Icon = ({ children, size = 20, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className={`${className} pointer-events-none`}>{children}</svg>
        );

        const Plus = (props) => <Icon {...props}><path d="M5 12h14M12 5v14"/></Icon>;
        const Trash2 = (props) => <Icon {...props}><path d="M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2M10 11v6M14 11v6"/></Icon>;
        const Users = (props) => <Icon {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></Icon>;
        const Receipt = (props) => <Icon {...props}><path d="M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z"/><path d="M16 8h-6"/><path d="M16 12h-6"/><path d="M10 16h-6"/></Icon>;
        const ChevronRight = (props) => <Icon {...props}><path d="m9 18 6-6-6-6"/></Icon>;
        const X = (props) => <Icon {...props}><path d="M18 6 6 18M6 6l12 12"/></Icon>;
        const Edit2 = (props) => <Icon {...props}><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></Icon>;
        const Save = (props) => <Icon {...props}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></Icon>;
        const Menu = (props) => <Icon {...props}><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></Icon>;
        const ArrowLeft = (props) => <Icon {...props}><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></Icon>;
        const AlertCircle = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></Icon>;
        const Percent = (props) => <Icon {...props}><line x1="19" y1="5" x2="5" y2="19"/><circle cx="6.5" cy="6.5" r="2.5"/><circle cx="17.5" cy="17.5" r="2.5"/></Icon>;
        const CheckCircle = (props) => <Icon {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></Icon>;
        const Globe = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></Icon>;
        const Share2 = (props) => <Icon {...props}><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></Icon>;
        const LinkIcon = (props) => <Icon {...props}><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></Icon>;
        const Check = (props) => <Icon {...props}><polyline points="20 6 9 17 4 12"/></Icon>;

        /* =========================================
           GENERIC UI COMPONENTS
           ========================================= */

        const Card = ({ children, className = "", onClick }) => (
            <div onClick={onClick} className={`bg-white border border-gray-100 rounded-xl shadow-[0_2px_8px_-4px_rgba(0,0,0,0.05)] ${className}`}>
                {children}
            </div>
        );

        const Button = ({ children, onClick, variant = 'primary', className = "", type="button" }) => {
            const baseStyle = "px-4 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 flex items-center justify-center gap-2 active:scale-[0.98]";
            const variants = {
                primary: "bg-gray-900 text-white hover:bg-black",
                secondary: "bg-white border border-gray-200 text-gray-700 hover:bg-gray-50 hover:border-gray-300",
                danger: "bg-red-50 text-red-600 hover:bg-red-100",
                ghost: "text-gray-500 hover:text-gray-900 hover:bg-gray-100",
                success: "bg-emerald-50 text-emerald-600 hover:bg-emerald-100"
            };
            return (
                <button type={type} onClick={onClick} className={`${baseStyle} ${variants[variant]} ${className}`}>
                    {children}
                </button>
            );
        };

        const Input = ({ label, value, onChange, placeholder, type = "text", prefixIcon, suffixIcon }) => (
            <div className="space-y-1.5">
                {label && <label className="block text-xs font-semibold text-gray-500 uppercase tracking-wider">{label}</label>}
                <div className="relative group">
                    {prefixIcon && (
                        <div className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 group-focus-within:text-gray-800 transition-colors text-sm">
                            {prefixIcon}
                        </div>
                    )}
                    <input 
                        type={type}
                        value={value}
                        onChange={onChange}
                        placeholder={placeholder}
                        className={`w-full bg-gray-50 border border-transparent rounded-lg py-2.5 ${prefixIcon ? 'pl-10' : 'px-3'} ${suffixIcon ? 'pr-10' : ''} text-gray-900 placeholder-gray-400 outline-none focus:bg-white focus:ring-1 focus:ring-gray-900 transition-all text-sm`}
                    />
                    {suffixIcon && (
                        <div className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400">
                            {suffixIcon}
                        </div>
                    )}
                </div>
            </div>
        );

        /* =========================================
           HELPER COMPONENTS
           ========================================= */

        const MarqueeText = ({ text }) => {
            const containerRef = useRef(null);
            const [shouldMarquee, setShouldMarquee] = useState(false);

            useEffect(() => {
                if (containerRef.current) {
                    setShouldMarquee(text.length > 12);
                }
            }, [text]);

            if (!shouldMarquee) {
                return <span className="font-semibold text-gray-900 truncate block">{text}</span>;
            }

            return (
                <div className="marquee-container w-full" ref={containerRef}>
                    <div className="marquee-content font-semibold text-gray-900">
                        {text} <span className="text-transparent">____</span> {text} <span className="text-transparent">____</span>
                    </div>
                </div>
            );
        };

        const ModalOverlay = ({ isOpen, onClose, children }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
                    <div className="absolute inset-0 bg-white/80 backdrop-blur-sm transition-opacity" onClick={onClose} />
                    <div className="relative w-full max-w-md bg-white rounded-2xl shadow-2xl border border-gray-100 animate-slide-up overflow-hidden max-h-[90vh] overflow-y-auto">
                        {children}
                    </div>
                </div>
            );
        };

        /* =========================================
           FEATURE MODALS
           ========================================= */

        const ActionModal = ({ config, onClose }) => {
            if (!config.isOpen) return null;
            return (
                <ModalOverlay isOpen={true} onClose={onClose}>
                    <div className="p-6 text-center">
                        <div className={`mx-auto w-12 h-12 rounded-full flex items-center justify-center mb-4 ${config.type === 'danger' ? 'bg-red-50 text-red-600' : 'bg-gray-50 text-gray-900'}`}>
                            {config.type === 'danger' ? <Trash2 size={20} /> : <AlertCircle size={20} />}
                        </div>
                        <h3 className="text-lg font-semibold text-gray-900 mb-2">{config.title}</h3>
                        <p className="text-sm text-gray-500 mb-6 leading-relaxed">{config.message}</p>
                        <div className="flex gap-3">
                            <Button variant="secondary" className="flex-1" onClick={onClose}>Cancel</Button>
                            <Button 
                                variant={config.type === 'danger' ? 'danger' : 'primary'} 
                                className={`flex-1 ${config.type === 'danger' ? 'bg-red-600 text-white hover:bg-red-700' : ''}`}
                                onClick={() => { config.onConfirm && config.onConfirm(); onClose(); }}
                            >
                                {config.confirmText || 'Confirm'}
                            </Button>
                        </div>
                    </div>
                </ModalOverlay>
            );
        };

        const ShareModal = ({ isOpen, onClose, data }) => {
            const [copied, setCopied] = useState(false);
            const [link, setLink] = useState('');

            useEffect(() => {
                if (isOpen && data) {
                    const compressed = LZString.compressToEncodedURIComponent(JSON.stringify(data));
                    const timestamp = Date.now();
                    const currentPath = window.location.pathname;
                    const basePath = currentPath.substring(0, currentPath.lastIndexOf('/'));
                    const shareUrl = `${window.location.origin}${basePath}/TravelSplit_Balance.html?data=${compressed}&time=${timestamp}`;
                    setLink(shareUrl);
                }
            }, [isOpen, data]);

            const copyToClipboard = () => {
                const copyText = (text) => {
                    const textArea = document.createElement("textarea");
                    textArea.value = text;
                    textArea.style.position = "fixed"; textArea.style.left = "-9999px";
                    document.body.appendChild(textArea);
                    textArea.focus(); textArea.select();
                    try { document.execCommand('copy'); setCopied(true); setTimeout(() => setCopied(false), 2000); } 
                    catch (err) { console.error('Fallback copy failed', err); }
                    document.body.removeChild(textArea);
                };
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(link).then(() => { setCopied(true); setTimeout(() => setCopied(false), 2000); }).catch(() => copyText(link));
                } else { copyText(link); }
            };

            return (
                <ModalOverlay isOpen={isOpen} onClose={onClose}>
                    <div className="p-6">
                        <div className="text-center mb-6">
                            <div className="w-12 h-12 bg-blue-50 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-3">
                                <Share2 size={24}/>
                            </div>
                            <h3 className="text-lg font-bold text-gray-900">Share Balance</h3>
                            <p className="text-sm text-gray-500 mt-1">Anyone with this link can view the current balance and expenses.</p>
                        </div>
                        <div className="bg-gray-50 p-3 rounded-lg border border-gray-200 mb-4 flex items-center gap-2">
                            <div className="bg-white p-1.5 rounded border border-gray-200"><LinkIcon size={14} className="text-gray-400"/></div>
                            <input readOnly value={link} className="bg-transparent flex-1 text-xs text-gray-600 outline-none truncate" />
                        </div>
                        <Button onClick={copyToClipboard} className={`w-full ${copied ? 'bg-green-600 hover:bg-green-700' : 'bg-gray-900'}`}>{copied ? <><Check size={16}/> Copied!</> : 'Copy Link'}</Button>
                    </div>
                </ModalOverlay>
            );
        };

        const SettlementDetailModal = ({ user, transactions, onClose, onSettle, currencySymbol }) => {
            const [settleMode, setSettleMode] = useState(null);
            const [amount, setAmount] = useState('');

            if (!user) return null;

            const owedToUser = transactions.filter(t => t.to === user);
            const userOwes = transactions.filter(t => t.from === user);
            const netBalance = owedToUser.reduce((a, t) => a + parseFloat(t.amount), 0) - userOwes.reduce((a, t) => a + parseFloat(t.amount), 0);

            const handleSettleClick = (toUser, maxAmount) => {
                setSettleMode({ toUser, maxAmount });
                setAmount(maxAmount.toString());
            };

            const confirmSettle = () => {
                const val = parseFloat(amount);
                if (val > 0) {
                    onSettle(user, settleMode.toUser, val);
                    setSettleMode(null);
                }
            };

            return (
                <ModalOverlay isOpen={true} onClose={onClose}>
                    <div className="border-b border-gray-100 p-4 flex items-center justify-between bg-white sticky top-0 z-10">
                        <span className="text-xs font-bold text-gray-400 uppercase tracking-widest">Balance Details</span>
                        <button onClick={onClose} className="text-gray-400 hover:text-gray-900 transition-colors"><X size={18} /></button>
                    </div>
                    
                    <div className="p-6 space-y-6">
                        <div className="text-center">
                            <h2 className="text-2xl font-bold text-gray-900">{user}</h2>
                            <p className={`text-sm font-medium mt-1 ${netBalance >= 0 ? 'text-emerald-600' : 'text-red-600'}`}>
                                {netBalance >= 0 ? `Net: +${currencySymbol}${netBalance.toFixed(2)}` : `Net: -${currencySymbol}${Math.abs(netBalance).toFixed(2)}`}
                            </p>
                        </div>

                        {settleMode ? (
                            <div className="bg-gray-50 rounded-xl p-4 space-y-4 animate-fade-in border border-gray-200">
                                <div className="flex justify-between items-center">
                                    <h3 className="font-semibold text-gray-900">Pay {settleMode.toUser}</h3>
                                    <button onClick={() => setSettleMode(null)} className="text-xs text-gray-400 hover:text-gray-900">Cancel</button>
                                </div>
                                <Input label="Amount" type="number" value={amount} onChange={e => setAmount(e.target.value)} prefixIcon={currencySymbol} />
                                <div className="flex gap-2">
                                    <Button variant="secondary" className="flex-1 text-xs py-2" onClick={() => setAmount(settleMode.maxAmount.toString())}>Full {currencySymbol}{settleMode.maxAmount}</Button>
                                    <Button variant="primary" className="flex-1 text-xs py-2" onClick={confirmSettle}>Confirm Payment</Button>
                                </div>
                            </div>
                        ) : (
                            <div className="space-y-6">
                                <div>
                                    <h3 className="text-xs font-bold text-gray-400 uppercase tracking-widest mb-3">Outgoing (Must pay)</h3>
                                    {userOwes.length === 0 ? <p className="text-sm text-gray-400 italic bg-gray-50 p-3 rounded-lg border border-gray-100">{user} owes nothing.</p> : (
                                        <div className="space-y-3">
                                            {userOwes.map((t, idx) => (
                                                <div key={idx} className="flex justify-between items-center p-3 bg-red-50/50 rounded-lg border border-red-100">
                                                    <div className="flex flex-col">
                                                        <span className="text-xs text-red-400 font-bold uppercase mb-0.5">Owe</span>
                                                        <span className="text-sm font-bold text-gray-900">{t.to}</span>
                                                    </div>
                                                    <div className="flex items-center gap-3">
                                                        <span className="text-sm font-bold text-red-700">-{currencySymbol}{t.amount}</span>
                                                        <button 
                                                            onClick={() => handleSettleClick(t.to, t.amount)}
                                                            className="bg-white text-gray-900 border border-gray-200 px-3 py-1.5 rounded-lg text-xs font-semibold hover:bg-gray-50 transition-colors shadow-sm"
                                                        >
                                                            Settle
                                                        </button>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                <div>
                                    <h3 className="text-xs font-bold text-gray-400 uppercase tracking-widest mb-3">Incoming (Get back)</h3>
                                    {owedToUser.length === 0 ? <p className="text-sm text-gray-400 italic bg-gray-50 p-3 rounded-lg border border-gray-100">No one owes {user} money.</p> : (
                                        <div className="space-y-3">
                                            {owedToUser.map((t, idx) => (
                                                <div key={idx} className="flex justify-between items-center p-3 bg-emerald-50/50 rounded-lg border border-emerald-100">
                                                    <div className="flex flex-col">
                                                        <span className="text-xs text-emerald-500 font-bold uppercase mb-0.5">From</span>
                                                        <span className="text-sm font-bold text-gray-900">{t.from}</span>
                                                    </div>
                                                    <span className="text-sm font-bold text-emerald-700">+{currencySymbol}{t.amount}</span>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}
                    </div>
                </ModalOverlay>
            );
        };

        const ReceiptModal = ({ receipt, onClose, onDelete, onUpdateName, currencySymbol }) => {
            const [isEditing, setIsEditing] = useState(false);
            const [editName, setEditName] = useState(receipt?.title || '');

            useEffect(() => { if (receipt) setEditName(receipt.title); }, [receipt]);
            if (!receipt) return null;

            return (
                <ModalOverlay isOpen={true} onClose={onClose}>
                    <div className="border-b border-gray-100 p-4 flex items-center justify-between bg-white">
                        <span className="text-xs font-bold text-gray-400 uppercase tracking-widest">Receipt Details</span>
                        <button onClick={onClose} className="text-gray-400 hover:text-gray-900 transition-colors"><X size={18} /></button>
                    </div>
                    
                    <div className="p-6 space-y-6">
                        <div className="flex items-start justify-between">
                            {isEditing ? (
                                <div className="flex gap-2 w-full">
                                    <input value={editName} onChange={e => setEditName(e.target.value)} className="flex-1 border-b border-gray-300 focus:border-black outline-none pb-1 text-xl font-semibold bg-transparent" autoFocus />
                                    <button onClick={() => { onUpdateName(receipt.id, editName); setIsEditing(false); }} className="bg-black text-white p-2 rounded-md"><Save size={16}/></button>
                                </div>
                            ) : (
                                <div className="space-y-1">
                                    <h2 className="text-xl font-semibold text-gray-900 flex items-center gap-2">
                                        {receipt.title} 
                                        <button onClick={() => setIsEditing(true)} className="text-gray-300 hover:text-gray-600"><Edit2 size={14}/></button>
                                    </h2>
                                    <p className="text-sm text-gray-500">{new Date(receipt.date).toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
                                </div>
                            )}
                            <div className="text-right">
                                <span className="block text-2xl font-bold text-gray-900">{currencySymbol}{receipt.total}</span>
                                {receipt.type === 'payment' && <span className="text-xs font-bold text-emerald-600 bg-emerald-50 px-2 py-1 rounded-full">PAYMENT</span>}
                            </div>
                        </div>

                        {receipt.type !== 'payment' && (
                            <div className="grid grid-cols-2 gap-4">
                                <div className="p-4 bg-gray-50 rounded-lg">
                                    <span className="text-xs text-gray-400 font-bold uppercase">Paid By</span>
                                    <p className="text-gray-900 font-medium mt-1">{receipt.payer}</p>
                                </div>
                                <div className="p-4 bg-gray-50 rounded-lg">
                                    <span className="text-xs text-gray-400 font-bold uppercase">Tax & Tip</span>
                                    <p className="text-gray-900 font-medium mt-1">{currencySymbol}{receipt.taxTip}</p>
                                </div>
                            </div>
                        )}

                        <div>
                            <h4 className="text-xs font-bold text-gray-900 uppercase tracking-widest mb-3">Breakdown</h4>
                            <div className="space-y-2">
                                {receipt.splitDetails.map((split, idx) => (
                                    <div key={idx} className="flex justify-between items-center py-2 border-b border-gray-50 last:border-0">
                                        <div className="flex items-center gap-3">
                                            <div className="w-6 h-6 rounded-full bg-gray-100 flex items-center justify-center text-[10px] font-bold text-gray-500">
                                                {split.name.charAt(0)}
                                            </div>
                                            <span className="text-sm text-gray-600">{split.name}</span>
                                        </div>
                                        <span className="text-sm font-medium text-gray-900">{currencySymbol}{parseFloat(split.amount).toFixed(2)}</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                    
                    <div className="bg-gray-50 p-4 border-t border-gray-100">
                        <Button variant="danger" className="w-full justify-center" onClick={() => onDelete(receipt.id)}>
                            Delete {receipt.type === 'payment' ? 'Payment Record' : 'Receipt'}
                        </Button>
                    </div>
                </ModalOverlay>
            );
        };

        const Sidebar = ({ isOpen, onClose, travelers, onAdd, onRemove, newName, setNewName, currency, setCurrency }) => {
            return (
                <>
                    <div className={`fixed inset-0 bg-white/80 backdrop-blur-sm z-40 transition-opacity duration-300 ${isOpen ? 'opacity-100' : 'opacity-0 pointer-events-none'}`} onClick={onClose} />
                    <div className={`fixed inset-y-0 right-0 w-full max-w-xs bg-white shadow-2xl z-50 transform transition-transform duration-300 ease-out border-l border-gray-100 ${isOpen ? 'translate-x-0' : 'translate-x-full'}`}>
                        <div className="flex flex-col h-full">
                            <div className="p-6 border-b border-gray-100 flex items-center justify-between">
                                <h2 className="text-lg font-semibold text-gray-900">Manage Travelers</h2>
                                <button onClick={onClose} className="text-gray-400 hover:text-gray-900"><X size={20} /></button>
                            </div>
                            
                            <div className="p-6 flex-1 overflow-y-auto">
                                <form onSubmit={onAdd} className="mb-8">
                                    <div className="flex gap-2">
                                        <input 
                                            className="flex-1 bg-gray-50 border-0 rounded-lg px-4 py-2.5 text-sm outline-none focus:ring-1 focus:ring-black placeholder-gray-400"
                                            placeholder="Add new name..."
                                            value={newName}
                                            onChange={e => setNewName(e.target.value)}
                                        />
                                        <button type="submit" className="bg-black text-white px-4 rounded-lg hover:bg-gray-800 transition-colors">
                                            <Plus size={18} />
                                        </button>
                                    </div>
                                </form>

                                <div className="space-y-1 mb-8">
                                    <h3 className="text-xs font-bold text-gray-400 uppercase tracking-widest mb-3 pl-1">Group Members</h3>
                                    {travelers.map(t => (
                                        <div key={t} className="group flex justify-between items-center p-3 rounded-lg hover:bg-gray-50 transition-colors">
                                            <div className="flex items-center gap-3">
                                                <div className="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-xs font-bold text-gray-600">
                                                    {t.charAt(0)}
                                                </div>
                                                <span className="text-sm font-medium text-gray-700">{t}</span>
                                            </div>
                                            <button 
                                                onClick={() => onRemove(t)}
                                                className="text-gray-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-all p-2"
                                            >
                                                <Trash2 size={16} />
                                            </button>
                                        </div>
                                    ))}
                                    {travelers.length === 0 && <p className="text-sm text-gray-400 italic text-center mt-4">No travelers yet.</p>}
                                </div>

                                {/* Currency Section */}
                                <div className="pt-6 border-t border-gray-100">
                                    <h3 className="text-xs font-bold text-gray-400 uppercase tracking-widest mb-3 pl-1 flex items-center gap-2">
                                        <Globe size={14}/> Currency
                                    </h3>
                                    <div className="relative">
                                        <select 
                                            value={currency} 
                                            onChange={(e) => setCurrency(e.target.value)}
                                            className="w-full bg-gray-50 border border-transparent rounded-lg py-2.5 px-3 appearance-none outline-none focus:bg-white focus:ring-1 focus:ring-black cursor-pointer text-sm font-medium"
                                        >
                                            {Object.keys(CURRENCIES).map(code => (
                                                <option key={code} value={code}>{CURRENCIES[code].label}</option>
                                            ))}
                                        </select>
                                        <ChevronRight className="absolute right-3 top-1/2 -translate-y-1/2 rotate-90 text-gray-400 pointer-events-none" size={16}/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </>
            );
        };

        /* =========================================
           MAIN APP LOGIC
           ========================================= */

        const App = () => {
            // State: Persistent Data
            const [travelers, setTravelers] = useState(() => JSON.parse(localStorage.getItem('travelers')) || []);
            const [receipts, setReceipts] = useState(() => JSON.parse(localStorage.getItem('receipts')) || []);
            const [currencyCode, setCurrencyCode] = useState(() => localStorage.getItem('currencyCode') || 'USD');
            
            // State: UI View Management
            const [view, setView] = useState('dashboard');
            const [selectedReceipt, setSelectedReceipt] = useState(null);
            const [selectedUserForSettlement, setSelectedUserForSettlement] = useState(null);
            const [isSidebarOpen, setIsSidebarOpen] = useState(false);
            const [isShareModalOpen, setIsShareModalOpen] = useState(false);
            const [newTravelerName, setNewTravelerName] = useState('');
            const [actionConfig, setActionConfig] = useState({ isOpen: false });
            
            // State: Hidden Feature
            const [logoClicks, setLogoClicks] = useState(0);

            // Derived
            const currencySymbol = CURRENCIES[currencyCode].symbol;

            // Persistence
            useEffect(() => {
                localStorage.setItem('travelers', JSON.stringify(travelers));
                localStorage.setItem('receipts', JSON.stringify(receipts));
                localStorage.setItem('currencyCode', currencyCode);
            }, [travelers, receipts, currencyCode]);

            /* PAIRWISE DEBT LOGIC */
            const settlement = useMemo(() => {
                const debtMatrix = {}; 
                travelers.forEach(t1 => {
                    debtMatrix[t1] = {};
                    travelers.forEach(t2 => { if(t1 !== t2) debtMatrix[t1][t2] = 0; });
                });

                receipts.forEach(r => {
                    const payer = r.payer;
                    r.splitDetails.forEach(split => {
                        const debtor = split.name;
                        const amount = parseFloat(split.amount);
                        if (payer !== debtor && debtMatrix[debtor] && debtMatrix[debtor][payer] !== undefined) {
                            debtMatrix[debtor][payer] += amount;
                        }
                    });
                });

                const transactions = [];
                const processedPairs = new Set();

                travelers.forEach(p1 => {
                    travelers.forEach(p2 => {
                        if (p1 === p2) return;
                        const pairKey = [p1, p2].sort().join('-');
                        if (processedPairs.has(pairKey)) return;
                        processedPairs.add(pairKey);

                        const p1OwesP2 = debtMatrix[p1][p2] || 0;
                        const p2OwesP1 = debtMatrix[p2][p1] || 0;
                        const net = p1OwesP2 - p2OwesP1;

                        if (net > 0.01) {
                            transactions.push({ from: p1, to: p2, amount: net.toFixed(2) });
                        } else if (net < -0.01) {
                            transactions.push({ from: p2, to: p1, amount: Math.abs(net).toFixed(2) });
                        }
                    });
                });
                return transactions;
            }, [receipts, travelers]);

            // Handlers
            const handleLogoClick = () => setLogoClicks(prev => prev + 1);
            
            const handleResetData = () => {
                setActionConfig({
                    isOpen: true,
                    title: 'Reset All Data?',
                    message: 'This will permanently delete all travelers, expenses, and settings. This cannot be undone.',
                    type: 'danger',
                    confirmText: 'Yes, Clear All',
                    onConfirm: () => {
                        localStorage.clear();
                        setTravelers([]); 
                        setReceipts([]);
                        setCurrencyCode('USD');
                        setLogoClicks(0);
                        setView('dashboard');
                    }
                });
            };

            const handleSettleDebt = (fromUser, toUser, amount) => {
                const newReceipt = {
                    id: Date.now(),
                    title: `Payment to ${toUser}`,
                    payer: fromUser,
                    date: new Date().toISOString(),
                    total: amount.toFixed(2),
                    taxTip: "0.00",
                    splitDetails: [{ name: toUser, amount: amount }],
                    mode: 'payment', 
                    type: 'payment'
                };
                setReceipts(prev => [newReceipt, ...prev]);
            };

            const addTraveler = (e) => {
                e.preventDefault();
                const name = newTravelerName.trim();
                if (name && !travelers.includes(name)) {
                    setTravelers([...travelers, name]);
                    setNewTravelerName('');
                } else if (name) {
                    setActionConfig({ isOpen: true, title: 'Duplicate', message: 'Person already exists.' });
                }
            };

            const removeTraveler = (name) => {
                const isInvolved = receipts.some(r => r.payer === name || r.splitDetails.some(s => s.name === name));
                if (isInvolved) {
                    setActionConfig({ isOpen: true, title: 'Action Blocked', message: `Cannot remove ${name} because they are part of existing receipts.` });
                    return;
                }
                setActionConfig({
                    isOpen: true,
                    title: 'Confirm Removal',
                    message: `Remove ${name} from the group?`,
                    type: 'danger',
                    confirmText: 'Remove',
                    onConfirm: () => setTravelers(prev => prev.filter(t => t !== name))
                });
            };

            const deleteReceipt = (id) => {
                setActionConfig({
                    isOpen: true,
                    title: 'Delete Item',
                    message: 'This action cannot be undone.',
                    type: 'danger',
                    confirmText: 'Delete',
                    onConfirm: () => { setReceipts(prev => prev.filter(r => r.id !== id)); setSelectedReceipt(null); }
                });
            };

            // ADD EXPENSE COMPONENT
            const AddReceiptForm = ({ onOpenSidebar }) => {
                const [title, setTitle] = useState(''); 
                const [payer, setPayer] = useState(travelers[0] || ''); 
                const [splitMode, setSplitMode] = useState('equal'); 
                const [amount, setAmount] = useState(''); 
                const [taxType, setTaxType] = useState('percent');
                const [taxValue, setTaxValue] = useState(''); 
                const [selectedPeople, setSelectedPeople] = useState(travelers.reduce((acc, t) => ({ ...acc, [t]: true }), {}));
                const [itemizedAmounts, setItemizedAmounts] = useState(travelers.reduce((acc, t) => ({ ...acc, [t]: [''] }), {}));

                useEffect(() => { 
                    if (!payer && travelers.length > 0) { 
                        setPayer(travelers[0]); 
                        setSelectedPeople(travelers.reduce((acc, t) => ({ ...acc, [t]: true }), {}));
                        setItemizedAmounts(prev => {
                            const newState = {...prev};
                            travelers.forEach(t => { if(!newState[t]) newState[t] = ['']; });
                            return newState;
                        });
                    } 
                }, [travelers.length]);

                const handleItemChange = (person, index, val) => {
                    const newAmounts = {...itemizedAmounts};
                    newAmounts[person][index] = val;
                    setItemizedAmounts(newAmounts);
                };

                const addItemRow = (person) => {
                    const newAmounts = {...itemizedAmounts};
                    newAmounts[person] = [...newAmounts[person], ''];
                    setItemizedAmounts(newAmounts);
                };

                const removeItemRow = (person, index) => {
                    const newAmounts = {...itemizedAmounts};
                    newAmounts[person] = newAmounts[person].filter((_, i) => i !== index);
                    setItemizedAmounts(newAmounts);
                };

                const handleSubmit = () => {
                    const involved = travelers.filter(t => selectedPeople[t]); 
                    if (involved.length === 0) return setActionConfig({ isOpen: true, title: 'Error', message: 'Select at least one person.' });
                    
                    let subTotal = 0; 
                    if(splitMode === 'equal') { 
                        subTotal = parseFloat(amount) || 0; 
                    } else { 
                        involved.forEach(p => {
                            const items = itemizedAmounts[p] || [];
                            items.forEach(v => subTotal += (parseFloat(v) || 0));
                        }); 
                    }

                    if(subTotal <= 0) return setActionConfig({ isOpen: true, title: 'Error', message: 'Enter a valid amount.' });
                    
                    let calculatedTax = 0; 
                    const taxInput = parseFloat(taxValue) || 0;
                    if (taxType === 'percent') { 
                        calculatedTax = (subTotal * taxInput) / 100; 
                    } else { 
                        calculatedTax = taxInput; 
                    }
                    
                    const finalTotal = subTotal + calculatedTax;
                    let finalSplit = []; 
                    
                    if (splitMode === 'equal') { 
                        finalSplit = involved.map(p => ({ name: p, amount: finalTotal / involved.length })); 
                    } else { 
                        finalSplit = involved.map(p => { 
                            const items = itemizedAmounts[p] || [];
                            let base = 0;
                            items.forEach(v => base += (parseFloat(v) || 0));
                            return { name: p, amount: base + (subTotal > 0 ? (base / subTotal) * calculatedTax : (calculatedTax / involved.length)) }; 
                        }); 
                    }
                    
                    const newReceipt = { 
                        id: Date.now(), 
                        title: title || 'Untitled', 
                        payer, 
                        date: new Date().toISOString(), 
                        total: finalTotal.toFixed(2), 
                        taxTip: calculatedTax.toFixed(2), 
                        splitDetails: finalSplit, 
                        mode: splitMode 
                    };
                    setReceipts([newReceipt, ...receipts]); setView('dashboard');
                };

                return (
                    <div className="max-w-2xl mx-auto pt-8 pb-20 px-4 animate-fade-in">
                        <button onClick={() => setView('dashboard')} className="flex items-center gap-2 text-gray-500 hover:text-black mb-6 transition-colors font-medium"><ArrowLeft size={18} /> Back</button>
                        <div className="space-y-8">
                            <div><h1 className="text-3xl font-bold tracking-tight text-gray-900 mb-2">New Expense</h1><p className="text-gray-500">Log a new receipt to split with the group.</p></div>
                            <Card className="p-8 space-y-8">
                                <Input label="Description" placeholder="e.g. Dinner at Mario's" value={title} onChange={e => setTitle(e.target.value)} />
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div className="space-y-1.5">
                                        <label className="block text-xs font-semibold text-gray-500 uppercase tracking-wider">Who Paid?</label>
                                        {travelers.length === 0 ? (
                                            <button onClick={onOpenSidebar} className="w-full bg-red-50 border border-red-200 text-red-600 rounded-lg py-2.5 px-3 text-left text-sm font-medium hover:bg-red-100 transition-colors flex justify-between items-center">Add Traveler first <Plus size={16}/></button>
                                        ) : (
                                            <div className="relative">
                                                <select className="w-full bg-gray-50 border border-transparent rounded-lg py-2.5 px-3 appearance-none outline-none focus:bg-white focus:ring-1 focus:ring-black cursor-pointer" value={payer} onChange={e => setPayer(e.target.value)}>
                                                    {travelers.map(t => <option key={t} value={t}>{t}</option>)}
                                                </select>
                                                <ChevronRight className="absolute right-3 top-1/2 -translate-y-1/2 rotate-90 text-gray-400 pointer-events-none" size={16}/>
                                            </div>
                                        )}
                                    </div>
                                    <div className="space-y-1.5">
                                        <div className="flex justify-between items-center">
                                            <label className="block text-xs font-semibold text-gray-500 uppercase tracking-wider">Tax & Tip</label>
                                            <div className="flex bg-gray-100 rounded p-0.5">
                                                <button onClick={()=>setTaxType('fixed')} className={`px-2 py-0.5 text-[10px] font-bold rounded ${taxType==='fixed' ? 'bg-white shadow text-black' : 'text-gray-500'}`}>{currencySymbol}</button>
                                                <button onClick={()=>setTaxType('percent')} className={`px-2 py-0.5 text-[10px] font-bold rounded ${taxType==='percent' ? 'bg-white shadow text-black' : 'text-gray-500'}`}>%</button>
                                            </div>
                                        </div>
                                        <Input 
                                            placeholder="0" type="number" value={taxValue} onChange={e => setTaxValue(e.target.value)} 
                                            prefixIcon={taxType === 'fixed' ? currencySymbol : null} suffixIcon={taxType === 'percent' ? <Percent size={14}/> : null} 
                                        />
                                    </div>
                                </div>

                                <div className="p-1 bg-gray-100 rounded-lg flex gap-1">
                                    <button onClick={() => setSplitMode('equal')} className={`flex-1 py-2 text-sm font-medium rounded-md transition-all ${splitMode === 'equal' ? 'bg-white shadow-sm text-black' : 'text-gray-500 hover:text-gray-700'}`}>Split Evenly</button>
                                    <button onClick={() => setSplitMode('itemized')} className={`flex-1 py-2 text-sm font-medium rounded-md transition-all ${splitMode === 'itemized' ? 'bg-white shadow-sm text-black' : 'text-gray-500 hover:text-gray-700'}`}>Itemized</button>
                                </div>
                                
                                {splitMode === 'equal' ? (
                                    <Input label="Subtotal Amount" type="number" placeholder="0.00" value={amount} onChange={e => setAmount(e.target.value)} prefixIcon={currencySymbol} />
                                ) : (
                                    <div className="border border-gray-100 rounded-lg p-4 space-y-4 bg-gray-50/50">
                                        <span className="text-xs font-bold text-gray-400 uppercase">Item Costs (Before Tax)</span>
                                        {travelers.map(t => (
                                            <div key={t} className="flex flex-col gap-2 p-3 bg-white rounded-lg border border-gray-100 shadow-sm">
                                                <div className="flex items-center justify-between">
                                                    <label className="flex items-center gap-2 cursor-pointer select-none">
                                                        <input type="checkbox" checked={selectedPeople[t]} onChange={() => setSelectedPeople({...selectedPeople, [t]: !selectedPeople[t]})} className="accent-black w-4 h-4"/>
                                                        <span className={`text-sm font-semibold ${selectedPeople[t] ? 'text-gray-900' : 'text-gray-400'}`}>{t}</span>
                                                    </label>
                                                    {selectedPeople[t] && (
                                                        <button onClick={() => addItemRow(t)} className="text-xs flex items-center gap-1 text-blue-600 hover:text-blue-700 font-medium px-2 py-1 rounded bg-blue-50 hover:bg-blue-100 transition-colors">
                                                            <Plus size={12}/> Add Item
                                                        </button>
                                                    )}
                                                </div>
                                                
                                                {selectedPeople[t] && (
                                                    <div className="space-y-2 pl-6">
                                                        {(itemizedAmounts[t] || ['']).map((val, idx) => (
                                                            <div key={idx} className="flex items-center gap-2 animate-fade-in">
                                                                <input 
                                                                    type="number" 
                                                                    placeholder="0.00" 
                                                                    className="flex-1 bg-gray-50 border border-gray-200 rounded px-2 py-1.5 text-right text-sm outline-none focus:border-black transition-colors" 
                                                                    value={val} 
                                                                    onChange={e => handleItemChange(t, idx, e.target.value)} 
                                                                />
                                                                <button onClick={() => removeItemRow(t, idx)} className="text-gray-400 hover:text-red-500 transition-colors p-1"><X size={14}/></button>
                                                            </div>
                                                        ))}
                                                        {(itemizedAmounts[t] || []).length === 0 && <p className="text-xs text-gray-400 italic">No items added.</p>}
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                )}
                                
                                {splitMode === 'equal' && (<div className="space-y-2"><label className="block text-xs font-semibold text-gray-500 uppercase tracking-wider">Split With</label><div className="flex flex-wrap gap-2">{travelers.length === 0 ? (<p className="text-sm text-gray-400 italic">No travelers available.</p>) : (travelers.map(t => (<button key={t} onClick={() => setSelectedPeople({...selectedPeople, [t]: !selectedPeople[t]})} className={`px-3 py-1.5 text-sm rounded-full border transition-all ${selectedPeople[t] ? 'bg-black border-black text-white' : 'bg-white border-gray-200 text-gray-500 hover:border-gray-300'}`}>{t}</button>)))}</div></div>)}
                                <Button className="w-full py-3 text-base" onClick={handleSubmit}>Save Expense</Button>
                            </Card>
                        </div>
                    </div>
                );
            };

            if (view === 'addReceipt') return <AddReceiptForm onOpenSidebar={() => setIsSidebarOpen(true)} />;

            return (
                <div className="min-h-screen bg-[#fafafa]">
                    <nav className="sticky top-0 z-20 bg-[#fafafa]/80 backdrop-blur-md border-b border-gray-100 px-6 py-4 flex justify-between items-center">
                        <div className="flex items-center gap-3">
                           <div onClick={handleLogoClick} className="flex items-center gap-2 font-bold text-xl tracking-tight text-gray-900 cursor-pointer select-none"><div className="w-8 h-8 bg-black text-white rounded-lg flex items-center justify-center"><Receipt size={18}/></div>TravelSplit</div>
                           <div className={`overflow-hidden transition-all duration-300 ease-out ${logoClicks >= 3 ? 'w-32 opacity-100 ml-2' : 'w-0 opacity-0'}`}><button onClick={handleResetData} className="bg-red-50 text-red-600 px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-red-100 transition-colors whitespace-nowrap flex items-center gap-1"><Trash2 size={12}/> Clear Data</button></div>
                        </div>
                        <div className="flex items-center gap-2">
                            <Button variant="ghost" onClick={() => setIsShareModalOpen(true)} className="p-2 text-blue-600 bg-blue-50 hover:bg-blue-100 hover:text-blue-700"><Share2 size={20}/></Button>
                            <Button variant="ghost" onClick={() => setIsSidebarOpen(true)} className="p-2"><Menu size={24}/></Button>
                        </div>
                    </nav>

                    <main className="max-w-4xl mx-auto p-6 md:p-12 space-y-12">
                        {/* Summary */}
                        <div className="grid grid-cols-2 gap-4">
                            <Card className="p-6"><p className="text-xs font-semibold text-gray-500 uppercase">Total Spent</p><p className="text-3xl font-bold text-gray-900 mt-2">{currencySymbol}{receipts.filter(r => r.type !== 'payment').reduce((acc, r) => acc + parseFloat(r.total), 0).toFixed(0)}</p></Card>
                            <Card className="p-6"><p className="text-xs font-semibold text-gray-500 uppercase">Transactions</p><p className="text-3xl font-bold text-gray-900 mt-2">{receipts.length}</p></Card>
                        </div>

                        {/* Settlement Cards */}
                        <section className="space-y-4">
                            <div className="flex justify-between items-center"><h2 className="text-sm font-bold text-gray-400 uppercase tracking-widest">Balances</h2><span className="text-xs text-gray-400">Scroll to see more &rarr;</span></div>
                            <div className="flex gap-4 overflow-x-auto pb-4 snap-x">
                                {travelers.length === 0 ? (<div className="w-full bg-white border border-dashed border-gray-200 rounded-xl p-8 text-center"><p className="text-gray-400 mb-2">No travelers yet</p><button onClick={() => setIsSidebarOpen(true)} className="text-sm font-medium text-black underline">Add people to start</button></div>) : (travelers.map(user => { 
                                    const myIncoming = settlement.filter(t => t.to === user);
                                    const myOutgoing = settlement.filter(t => t.from === user);
                                    const totalIn = myIncoming.reduce((sum, t) => sum + parseFloat(t.amount), 0);
                                    const totalOut = myOutgoing.reduce((sum, t) => sum + parseFloat(t.amount), 0);
                                    const isSettled = totalIn === 0 && totalOut === 0;

                                    return (
                                        <Card key={user} onClick={() => setSelectedUserForSettlement(user)} className="min-w-[160px] max-w-[160px] p-4 flex-shrink-0 snap-center cursor-pointer hover:border-gray-400 transition-all group">
                                            <div className="mb-4">
                                                <div className="w-10 h-10 rounded-full bg-gray-50 border border-gray-100 flex items-center justify-center text-sm font-bold text-gray-600 mb-3 group-hover:bg-gray-100 transition-colors">{user.charAt(0)}</div>
                                                <MarqueeText text={user} />
                                            </div>
                                            <div className="space-y-2 pt-2 border-t border-gray-50">
                                                {totalOut > 0 && (
                                                    <div className="flex justify-between items-center">
                                                        <span className="text-[10px] font-bold text-red-400 uppercase tracking-wider">Owes</span>
                                                        <span className="text-sm font-bold text-red-600">-{currencySymbol}{totalOut.toFixed(2)}</span>
                                                    </div>
                                                )}
                                                {totalIn > 0 && (
                                                    <div className="flex justify-between items-center">
                                                        <span className="text-[10px] font-bold text-emerald-500 uppercase tracking-wider">Gets</span>
                                                        <span className="text-sm font-bold text-emerald-600">+{currencySymbol}{totalIn.toFixed(2)}</span>
                                                    </div>
                                                )}
                                                {isSettled && (
                                                    <div className="text-center py-1">
                                                       <span className="text-xs font-bold text-gray-300 uppercase tracking-widest">Settled</span>
                                                    </div>
                                                )}
                                            </div>
                                        </Card>
                                    ); 
                                }))}
                            </div>
                        </section>

                        {/* Recent Activity */}
                        <section className="space-y-6">
                            <div className="flex items-center justify-between"><h2 className="text-sm font-bold text-gray-400 uppercase tracking-widest">Recent Activity</h2><Button variant="primary" onClick={() => setView('addReceipt')} className="shadow-lg shadow-gray-200"><Plus size={16}/> New Expense</Button></div>
                            {receipts.length === 0 ? (<div className="border-2 border-dashed border-gray-100 rounded-xl p-12 text-center"><p className="text-gray-400 mb-4">No activity yet</p><Button variant="secondary" onClick={() => setView('addReceipt')}>Add your first expense</Button></div>) : (<div className="space-y-3">{receipts.map(r => (<div key={r.id} onClick={() => setSelectedReceipt(r)} className="group bg-white p-5 rounded-xl border border-gray-100 hover:border-gray-300 hover:shadow-sm transition-all cursor-pointer flex justify-between items-center"><div className="flex items-center gap-4">{r.type === 'payment' ? (<div className="w-10 h-10 rounded-full bg-emerald-50 text-emerald-600 flex items-center justify-center text-sm font-bold border border-emerald-100"><CheckCircle size={18} /></div>) : (<div className="w-10 h-10 rounded-full bg-gray-50 text-gray-600 flex items-center justify-center text-sm font-bold border border-gray-100">{r.payer.charAt(0)}</div>)}<div><h3 className={`font-semibold ${r.type === 'payment' ? 'text-emerald-700' : 'text-gray-900'}`}>{r.title}</h3><p className="text-xs text-gray-500 mt-0.5">{r.payer} paid • {new Date(r.date).toLocaleDateString(undefined, {month:'short', day:'numeric'})}</p></div></div><div className="text-right"><span className={`block font-mono font-medium ${r.type === 'payment' ? 'text-emerald-600' : 'text-gray-900'}`}>{currencySymbol}{r.total}</span></div></div>))}</div>)}
                        </section>
                    </main>

                    <Sidebar isOpen={isSidebarOpen} onClose={() => setIsSidebarOpen(false)} travelers={travelers} onAdd={addTraveler} onRemove={removeTraveler} newName={newTravelerName} setNewName={setNewTravelerName} currency={currencyCode} setCurrency={setCurrencyCode} />
                    <ReceiptModal receipt={selectedReceipt} onClose={() => setSelectedReceipt(null)} onDelete={deleteReceipt} onUpdateName={(id, name) => setReceipts(prev => prev.map(r => r.id === id ? {...r, title: name} : r))} currencySymbol={currencySymbol} />
                    <SettlementDetailModal user={selectedUserForSettlement} transactions={settlement} onClose={() => setSelectedUserForSettlement(null)} onSettle={handleSettleDebt} currencySymbol={currencySymbol} />
                    <ActionModal config={actionConfig} onClose={() => setActionConfig({...actionConfig, isOpen: false})} />
                    <ShareModal isOpen={isShareModalOpen} onClose={() => setIsShareModalOpen(false)} data={{ travelers, receipts, currencyCode }} />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
