<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moomoo Multi-Currency Fee Calculator</title>
    <style>
        :root {
            --moomoo-dark: #121826;
            --moomoo-primary: #2e5bff;
            --moomoo-secondary: #1a3a8f;
            --moomoo-accent: #4cc9f0;
            --moomoo-text: #e0e0e0;
            --moomoo-light-text: #a0a0a0;
            --moomoo-card-bg: #1e293b;
            --moomoo-green: #00c087;
            --moomoo-red: #ff5b5a;
            --border-radius: 8px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Roboto, -apple-system, sans-serif;
            background-color: var(--moomoo-dark);
            color: var(--moomoo-text);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .calculator-container {
            max-width: 500px;
            margin: 0 auto;
        }
        
        .calculator-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .calculator-header h1 {
            font-size: 1.5rem;
            color: white;
            font-weight: 600;
        }
        
        .calculator-card {
            background-color: var(--moomoo-card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: var(--moomoo-light-text);
        }
        
        .currency-selector {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .currency-selector label {
            margin-right: 10px;
            font-size: 0.9rem;
        }
        
        .currency-selector select {
            flex-grow: 1;
            padding: 10px 15px;
            background-color: var(--moomoo-card-bg);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: var(--border-radius);
            color: white;
            font-size: 0.9rem;
        }
        
        /* Fix dropdown options visibility */
        .currency-selector select option {
            background-color: var(--moomoo-card-bg);
            color: white;
        }
        
        .input-group input, 
        .input-group select {
            width: 100%;
            padding: 12px 15px;
            background-color: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: var(--border-radius);
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .input-group input:focus, 
        .input-group select:focus {
            outline: none;
            border-color: var(--moomoo-primary);
            box-shadow: 0 0 0 2px rgba(46, 91, 255, 0.2);
        }
        
        .btn-calculate {
            width: 100%;
            padding: 14px;
            background-color: var(--moomoo-primary);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 10px;
        }
        
        .btn-calculate:hover {
            background-color: var(--moomoo-secondary);
        }
        
        .results-section {
            margin-top: 25px;
        }
        
        .result-card {
            background-color: var(--moomoo-card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 15px;
        }
        
        .result-card h3 {
            color: var(--moomoo-accent);
            margin-bottom: 15px;
            font-size: 1.1rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 10px;
        }
        
        .result-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        
        .result-row:last-child {
            margin-bottom: 0;
        }
        
        .result-label {
            color: var(--moomoo-light-text);
        }
        
        .result-value {
            font-weight: 600;
            text-align: right;
        }
        
        .break-even-card {
            border-left: 4px solid var(--moomoo-primary);
            background-color: rgba(46, 91, 255, 0.1);
        }
        
        .break-even-price {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--moomoo-green);
        }
        
        .fee-details {
            font-size: 0.8rem;
            color: var(--moomoo-light-text);
            margin-top: 3px;
        }
        
        .currency-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .currency-item {
            background-color: rgba(255,255,255,0.05);
            padding: 10px;
            border-radius: var(--border-radius);
        }
        
        .currency-flag {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 8px;
            display: inline-block;
            vertical-align: middle;
        }
        
        .currency-code {
            font-weight: 600;
        }
        
        .currency-rate {
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        @media (max-width: 480px) {
            body {
                padding: 15px;
            }
            
            .calculator-card {
                padding: 15px;
            }
            
            .input-group input, 
            .input-group select {
                padding: 10px 12px;
            }
            
            .currency-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <div class="calculator-header">
            <h1>Multi-Currency Fee Calculator</h1>
        </div>
        
        <div class="calculator-card">
            <div class="currency-selector">
                <label for="currency">Currency:</label>
                <select id="currency">
                    <option value="MYR" selected>Malaysian Ringgit (RM)</option>
                    <option value="USD">US Dollar ($)</option>
                    <option value="CNY">Chinese Yuan (Â¥)</option>
                    <option value="JPY">Japanese Yen (Â¥)</option>
                    <option value="SGD">Singapore Dollar (S$)</option>
                    <option value="EUR">Euro (â‚¬)</option>
                    <option value="HKD">Hong Kong Dollar (HK$)</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="stockPrice">Purchase Price per Share</label>
                <input type="number" id="stockPrice" step="0.0001" placeholder="e.g. 25.50" required>
            </div>
            
            <div class="input-group">
                <label for="quantity">Number of Shares</label>
                <input type="number" id="quantity" step="0.01" placeholder="e.g. 100" required>
            </div>
            
            <div class="input-group">
                <label for="orderType">Order Type</label>
                <select id="orderType">
                    <option value="buy">Buy Order</option>
                    <option value="sell">Sell Order</option>
                </select>
            </div>
            
            <button class="btn-calculate" id="calculateBtn">Calculate Fees</button>
        </div>
        
        <div class="results-section" id="results">
            <!-- Results will be inserted here -->
        </div>
    </div>

    <script>
        // Moomoo Fee Structure (in USD)
        const FEE_STRUCTURE = {
            platformFee: 0.99, // Fixed platform fee in USD
            gstRate: 0.09, // 9% GST on platform fee only
            settlementFeePerShare: 0.003, // $0.003 per share
            settlementFeeCapRate: 0.01, // Capped at 1% of trade value
            secFeeRate: 0.0000278, // 0.00278% of trade value (sell only)
            secFeeMin: 0.01, // $0.01 minimum (sell only)
            tafPerShare: 0.000166, // $0.000166 per share (sell only)
            tafMin: 0.01, // $0.01 minimum (sell only)
            tafMax: 8.30 // $8.30 maximum (sell only)
        };

        // Exchange rates (1 USD = X currency)
        const exchangeRates = {
            MYR: 4.70, // Malaysian Ringgit
            USD: 1,    // US Dollar
            CNY: 7.20, // Chinese Yuan
            JPY: 150,  // Japanese Yen
            SGD: 1.35, // Singapore Dollar
            EUR: 0.93, // Euro
            HKD: 7.83  // Hong Kong Dollar
        };

        // Currency symbols and flags
        const currencyInfo = {
            MYR: { symbol: 'RM', flag: 'ðŸ‡²ðŸ‡¾' },
            USD: { symbol: '$', flag: 'ðŸ‡ºðŸ‡¸' },
            CNY: { symbol: 'Â¥', flag: 'ðŸ‡¨ðŸ‡³' },
            JPY: { symbol: 'Â¥', flag: 'ðŸ‡¯ðŸ‡µ' },
            SGD: { symbol: 'S$', flag: 'ðŸ‡¸ðŸ‡¬' },
            EUR: { symbol: 'â‚¬', flag: 'ðŸ‡ªðŸ‡º' },
            HKD: { symbol: 'HK$', flag: 'ðŸ‡­ðŸ‡°' }
        };

        // DOM Elements
        const calculateBtn = document.getElementById('calculateBtn');
        const resultsContainer = document.getElementById('results');
        const currencySelect = document.getElementById('currency');

        // Initialize calculator
        document.addEventListener('DOMContentLoaded', function() {
            // Setup calculate button
            calculateBtn.addEventListener('click', calculateFees);
        });

        // Format currency based on selection
        function formatCurrency(amount, currency, decimals = 4) {
            return `${currencyInfo[currency].symbol}${amount.toLocaleString('en-US', {
                minimumFractionDigits: 2, 
                maximumFractionDigits: decimals
            })}`;
        }

        function calculateFees() {
            try {
                const selectedCurrency = currencySelect.value;
                const stockPrice = parseFloat(document.getElementById('stockPrice').value);
                const quantity = parseFloat(document.getElementById('quantity').value);
                const isSellOrder = document.getElementById('orderType').value === 'sell';
                
                // Validate inputs
                if (isNaN(stockPrice) || stockPrice <= 0) {
                    showError('Please enter a valid stock price (> 0)');
                    return;
                }
                
                if (isNaN(quantity) || quantity <= 0) {
                    showError('Please enter a valid share quantity (> 0)');
                    return;
                }

                // Show loading state
                resultsContainer.innerHTML = '<div class="result-card"><p>Calculating fees...</p></div>';
                
                // Convert input price to USD for calculations
                const stockPriceUSD = stockPrice / exchangeRates[selectedCurrency];
                
                // Calculate fees in USD
                const result = calculateMoomooFees(stockPriceUSD, quantity, isSellOrder);
                
                // Display results
                displayResults(result, selectedCurrency);
                
            } catch (error) {
                console.error("Calculation error:", error);
                showError('An error occurred. Please check your inputs.');
            }
        }
        
        function calculateMoomooFees(stockPriceUSD, quantity, isSellOrder) {
            const totalTradeValueUSD = stockPriceUSD * quantity;
            
            // 1. Platform Fee ($0.99 fixed)
            const platformFeeUSD = FEE_STRUCTURE.platformFee;
            
            // 2. GST on Platform Fee (9%)
            const gstUSD = platformFeeUSD * FEE_STRUCTURE.gstRate;
            
            // 3. Settlement Fee ($0.003/share, capped at 1% of trade value)
            const settlementFeeUncappedUSD = FEE_STRUCTURE.settlementFeePerShare * quantity;
            const settlementFeeCapUSD = totalTradeValueUSD * FEE_STRUCTURE.settlementFeeCapRate;
            const settlementFeeUSD = Math.min(settlementFeeUncappedUSD, settlementFeeCapUSD);
            
            // 4. SEC Fee (sell orders only)
            let secFeeUSD = 0;
            if (isSellOrder) {
                secFeeUSD = totalTradeValueUSD * FEE_STRUCTURE.secFeeRate;
                secFeeUSD = Math.max(secFeeUSD, FEE_STRUCTURE.secFeeMin);
            }
            
            // 5. TAF Fee (sell orders only)
            let tafFeeUSD = 0;
            if (isSellOrder) {
                tafFeeUSD = FEE_STRUCTURE.tafPerShare * quantity;
                tafFeeUSD = Math.max(tafFeeUSD, FEE_STRUCTURE.tafMin);
                tafFeeUSD = Math.min(taafFeeUSD, FEE_STRUCTURE.tafMax);
            }
            
            // Calculate totals in USD
            const totalFeesUSD = platformFeeUSD + gstUSD + settlementFeeUSD + secFeeUSD + tafFeeUSD;
            const totalCostUSD = totalTradeValueUSD + totalFeesUSD; // For buy orders
            
            // Break-even price (price needed when selling to recover costs)
            const breakEvenPriceUSD = totalCostUSD / quantity;
            const feePercentage = (totalFeesUSD / totalTradeValueUSD * 100);
            
            return {
                stockPriceUSD,
                quantity,
                totalTradeValueUSD,
                platformFeeUSD,
                gstUSD,
                settlementFeeUSD,
                secFeeUSD,
                tafFeeUSD,
                totalFeesUSD,
                totalCostUSD,
                breakEvenPriceUSD,
                feePercentage
            };
        }
        
        function displayResults(result, selectedCurrency) {
            const isSellOrder = document.getElementById('orderType').value === 'sell';
            
            // Convert USD results to selected currency
            const convertToSelected = (amount) => amount * exchangeRates[selectedCurrency];
            
            let html = `
                <div class="result-card">
                    <h3>Order Details (${selectedCurrency})</h3>
                    <div class="result-row">
                        <span class="result-label">Purchase Price</span>
                        <span class="result-value">${formatCurrency(result.stockPriceUSD * exchangeRates[selectedCurrency], selectedCurrency, 4)}</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Shares</span>
                        <span class="result-value">${result.quantity.toLocaleString()}</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Trade Value</span>
                        <span class="result-value">${formatCurrency(result.totalTradeValueUSD * exchangeRates[selectedCurrency], selectedCurrency, 2)}</span>
                    </div>
                </div>
                
                <div class="result-card">
                    <h3>Fee Breakdown (${selectedCurrency})</h3>
                    <div class="result-row">
                        <span class="result-label">Platform Fee</span>
                        <span class="result-value">${formatCurrency(result.platformFeeUSD * exchangeRates[selectedCurrency], selectedCurrency, 2)}</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">GST (9%)</span>
                        <span class="result-value">${formatCurrency(result.gstUSD * exchangeRates[selectedCurrency], selectedCurrency, 2)}</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Settlement Fee</span>
                        <span class="result-value">${formatCurrency(result.settlementFeeUSD * exchangeRates[selectedCurrency], selectedCurrency, 4)}</span>
                    </div>
            `;
            
            if (isSellOrder) {
                html += `
                    <div class="result-row">
                        <span class="result-label">SEC Fee</span>
                        <span class="result-value">${formatCurrency(result.secFeeUSD * exchangeRates[selectedCurrency], selectedCurrency, 4)}</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">TAF Fee</span>
                        <span class="result-value">${formatCurrency(result.tafFeeUSD * exchangeRates[selectedCurrency], selectedCurrency, 4)}</span>
                    </div>
                `;
            }
            
            html += `
                    <div class="result-row" style="margin-top: 15px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1);">
                        <span class="result-label" style="font-weight: 600;">Total Fees</span>
                        <span class="result-value" style="font-weight: 700;">${formatCurrency(result.totalFeesUSD * exchangeRates[selectedCurrency], selectedCurrency, 4)} (${result.feePercentage.toFixed(4)}%)</span>
                    </div>
                </div>
                
                <div class="result-card break-even-card">
                    <h3>Break-Even Analysis (${selectedCurrency})</h3>
                    <div class="result-row">
                        <span class="result-label">Total Cost</span>
                        <span class="result-value">${formatCurrency(result.totalCostUSD * exchangeRates[selectedCurrency], selectedCurrency, 2)}</span>
                    </div>
                    <div class="result-row" style="margin: 15px 0;">
                        <span class="result-label">Break-Even Price</span>
                        <span class="result-value break-even-price">${formatCurrency(result.breakEvenPriceUSD * exchangeRates[selectedCurrency], selectedCurrency, 4)}</span>
                    </div>
                    <div class="fee-details">
                        You need to sell at ${formatCurrency(result.breakEvenPriceUSD * exchangeRates[selectedCurrency], selectedCurrency, 4)} per share to recover your total investment after fees.
                    </div>
                </div>
                
                <div class="result-card">
                    <h3>Multi-Currency Conversion</h3>
                    <div class="currency-grid">
            `;
            
            // Add all currency conversions (excluding selected currency)
            for (const currency of Object.keys(exchangeRates)) {
                if (currency !== selectedCurrency) {
                    const rateToSelected = exchangeRates[selectedCurrency] / exchangeRates[currency];
                    const totalCostConverted = result.totalCostUSD * exchangeRates[currency];
                    const breakEvenConverted = result.breakEvenPriceUSD * exchangeRates[currency];
                    
                    html += `
                        <div class="currency-item">
                            <div>
                                <span class="currency-flag">${currencyInfo[currency].flag}</span>
                                <span class="currency-code">${currency} (${currencyInfo[currency].symbol})</span>
                            </div>
                            <div class="currency-rate">
                                <div>Total Cost: ${formatCurrency(totalCostConverted, currency, 2)}</div>
                                <div>Break-Even: ${formatCurrency(breakEvenConverted, currency, 4)}</div>
                                <div>1 ${selectedCurrency} = ${rateToSelected.toFixed(4)} ${currency}</div>
                            </div>
                        </div>
                    `;
                }
            }
            
            html += `
                    </div>
                </div>
            `;
            
            resultsContainer.innerHTML = html;
        }
        
        function showError(message) {
            resultsContainer.innerHTML = `
                <div class="result-card" style="border-left: 4px solid var(--moomoo-red);">
                    <h3 style="color: var(--moomoo-red);">Error</h3>
                    <p>${message}</p>
                </div>
            `;
        }
    </script>
</body>
</html>
